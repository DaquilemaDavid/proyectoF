<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/base :: head('Nuevo Establecimiento')}"></head>
<body>
    
    <nav th:replace="~{layout/base :: menu}"></nav>

    <div class="container mt-5 mb-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow border-0">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="fa-solid fa-plus-circle me-2"></i>Registro de Nuevo Establecimiento</h4>
                    </div>
                    <div class="card-body p-4">
                        
                        <form id="formEstablecimiento" th:action="@{/establecimientos/guardar}" th:object="${establecimiento}" method="post" novalidate>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Código del Establecimiento</label>
                                    <input type="number" th:field="*{codigoEst}" class="form-control" placeholder="Ej: 101" required>
                                    <div class="form-text">Asigne un código único numérico.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Código Empresa</label>
                                    <input type="number" th:field="*{codigoEmp}" class="form-control" placeholder="Ej: 1">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Descripción / Nombre</label>
                                <input type="text" th:field="*{descripcionEst}" class="form-control" placeholder="Nombre del establecimiento">
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Dirección</label>
                                <input type="text" th:field="*{direccionEst}" class="form-control" placeholder="Ubicación física">
                            </div>

                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-bold">Ciudad</label>
                                    <input type="text" th:field="*{ciudadEst}" class="form-control" placeholder="Ej: Quito">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-bold">Estado</label>
                                    <select th:field="*{estadoEst}" class="form-select">
                                        <option value="Activo">Activo</option>
                                        <option value="Inactivo">Inactivo</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-bold">Teléfono</label>
                                    <input type="text" th:field="*{telefonoEst}" class="form-control" placeholder="Ej: 022123456">
                                </div>
                            </div>

                            <div class="d-grid gap-2 mt-4">
                                <button type="submit" class="btn btn-success btn-lg"><i class="fa-solid fa-floppy-disk me-2"></i>Guardar Establecimiento</button>
                                <a th:href="@{/establecimientos}" class="btn btn-secondary">Cancelar</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer th:replace="~{layout/base :: footer}"></footer>
    <div th:replace="~{layout/base :: scripts}"></div>

    <script>
        $(document).ready(function() {
            $("#formEstablecimiento").validate({
                rules: {
                    codigoEst: { required: true, digits: true },
                    descripcionEst: { required: true, minlength: 3 },
                    direccionEst: { required: true },
                    ciudadEst: { required: true },
                    telefonoEst: { digits: true }
                },
                messages: {
                    codigoEst: { required: "El código es obligatorio", digits: "Solo ingrese números" },
                    descripcionEst: { required: "La descripción es obligatoria", minlength: "Mínimo 3 caracteres" },
                    direccionEst: { required: "La dirección es obligatoria" },
                    ciudadEst: { required: "La ciudad es obligatoria" },
                    telefonoEst: { digits: "Solo números permitidos" }
                },
                errorElement: "div",
                errorClass: "text-danger small mt-1", 
                highlight: function(element) { $(element).addClass("is-invalid").removeClass("is-valid"); },
                unhighlight: function(element) { $(element).removeClass("is-invalid").addClass("is-valid"); },
                submitHandler: function(form) {
                    Swal.fire({
                        title: 'Procesando...',
                        text: 'Guardando registro',
                        allowOutsideClick: false,
                        didOpen: () => { Swal.showLoading() }
                    });
                    form.submit();
                }
            });
        });
    </script>
</body>
</html>